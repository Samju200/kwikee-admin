<div class="greetings-area mt-5">
  <div class="row justify-content-between">
    <div class="col-md-6 col-lg-5">
      <h4>View Credit</h4>
      <p>View single credit details</p>
    </div>
  </div>
</div>
<div class="mt-5">
  <loading-spinner style="min-height: 500px" [spinning]="loading">
    <ng-container *ngIf="userDetails; else showNoLoan">
      <div class="row">
        <div class="col-sm-12 mb-5">
          <div class="card mb-4">
            <div class="card-body">
              <div class="p-1">
                <div class="d-flex py-2 my-1 align-items-center">
                  <img style="border-radius: 100%;
                    border: 0.5px solid black;
                    object-fit: cover; overflow: hidden;"
                    [src]="creditDetails.passport ? creditDetails.passport : 'https://via.placeholder.com/75'"
                    alt="" width="75" height="75" (error)="onImgError($event)">
                  <h5 class="ms-2">
                    {{userDetails?.title}}&nbsp;{{userDetails?.firstname |
                        titlecase}}&nbsp;{{userDetails?.lastname | titlecase}}
                  </h5>
                </div>
                <div class="row g-2">
                  <ng-container *ngIf="userDetails.credit_status == '0' || userDetails.credit_status == '5'">
                    <div class="col-auto">
                      <button (click)="openRejectOrCancelModal('reject')"
                        class="btn btn-sm btn-outline-danger">Reject</button>
                    </div>
                    <div class="col-auto">
                      <button (click)="openRejectOrCancelModal('cancel')" class="btn btn-sm btn-warning">Cancel</button>
                    </div>
                    <div class="col-auto">
                      <button class="btn btn-outline-dark btn-sm" (click)="openUploadDocumentsModal()">Upload
                        Documents</button>
                    </div>
                    <div class="col-auto">
                      <button (click)="linkBankCardOrStatement('card')" class="btn btn-outline-dark btn-sm">
                        Link Bank Card
                      </button>
                    </div>
                    <div class="col-auto">
                      <button (click)="linkBankCardOrStatement('statement')" class="btn btn-outline-dark btn-sm">
                        Link Bank Statement
                      </button>
                    </div>
                    <div class="col-auto">
                      <button class="btn btn-outline-dark btn-sm"
                        (click)="openPerformUnderwritingModal('underwriting')">Perform
                        Underwriting</button>
                    </div>
                    <div class="col-auto">
                      <button (click)="openEditLoanModal()" class="btn btn-outline-dark btn-sm">Edit
                        Application</button>
                    </div>
                    <div *ngIf="userDetails.credit_status == '0'" class="col-auto">
                      <button (click)="moveToPendingUnderwriting()" class="btn btn-outline-dark btn-sm">Move to Pending
                        Underwriting</button>
                    </div>
                    <div class="col-auto">
                      <button class="btn btn-outline-dark btn-sm" (click)="openExportTransactionsModal()">Export
                        Transactions</button>
                    </div>
                  </ng-container>
                  <ng-container *ngIf="userDetails.credit_status == '1'">
                    <div class="col-auto">
                      <button (click)="openRejectOrCancelModal('cancel')" class="btn btn-sm btn-warning">Cancel</button>
                    </div>
                    <div class="col-auto">
                      <button class="btn btn-outline-dark btn-sm" (click)="openUploadDocumentsModal()">Upload
                        Documents</button>
                    </div>
                    <div class="col-auto">
                      <button (click)="linkBankCardOrStatement('card')" class="btn btn-outline-dark btn-sm">
                        Link Bank Card
                      </button>
                    </div>
                    <div class="col-auto">
                      <button (click)="linkBankCardOrStatement('statement')" class="btn btn-outline-dark btn-sm">
                        Link Bank Statement
                      </button>
                    </div>
                    <div class="col-auto">
                      <button class="btn btn-outline-dark btn-sm"
                        (click)="openPerformUnderwritingModal('repayment')">Add Repayment</button>
                    </div>
                    <div class="col-auto">
                      <button (click)="markAsFullyPaid()" class="btn btn-outline-dark btn-sm">Mark as Fully
                        Paid</button>
                    </div>
                    <div class="col-auto">
                      <button class="btn btn-outline-dark btn-sm" (click)="openExportTransactionsModal()">Export
                        Transactions</button>
                    </div>
                  </ng-container>
                  <ng-container *ngIf="userDetails.credit_status == '2'">
                    <div class="col-auto">
                      <button (click)="openRejectOrCancelModal('cancel')" class="btn btn-sm btn-warning">Cancel</button>
                    </div>
                    <div class="col-auto">
                      <button class="btn btn-outline-dark btn-sm" (click)="openUploadDocumentsModal()">Upload
                        Documents</button>
                    </div>
                    <div class="col-auto">
                      <button (click)="linkBankCardOrStatement('card')" class="btn btn-outline-dark btn-sm">
                        Link Bank Card
                      </button>
                    </div>
                    <div class="col-auto">
                      <button (click)="linkBankCardOrStatement('statement')" class="btn btn-outline-dark btn-sm">
                        Link Bank Statement
                      </button>
                    </div>
                    <div class="col-auto">
                      <button class="btn btn-outline-dark btn-sm"
                        (click)="openPerformUnderwritingModal('repayment')">Add Repayment</button>
                    </div>
                    <div class="col-auto">
                      <button (click)="markAsFullyPaid()" class="btn btn-outline-dark btn-sm">Mark as Fully
                        Paid</button>
                    </div>
                    <div class="col-auto">
                      <button class="btn btn-outline-dark btn-sm"
                        (click)="openPerformUnderwritingModal('underwriting')">Perform
                        Underwriting</button>
                    </div>
                    <div class="col-auto">
                      <button class="btn btn-outline-dark btn-sm" (click)="openExportTransactionsModal()">Export
                        Transactions</button>
                    </div>
                  </ng-container>
                  <ng-container *ngIf="userDetails.credit_status == '3'">
                    <div class="col-auto">
                      <button (click)="openRejectOrCancelModal('cancel')" class="btn btn-sm btn-warning">Cancel</button>
                    </div>
                    <div class="col-auto">
                      <button class="btn btn-outline-dark btn-sm" (click)="openUploadDocumentsModal()">Upload
                        Documents</button>
                    </div>
                    <div class="col-auto">
                      <button (click)="linkBankCardOrStatement('card')" class="btn btn-outline-dark btn-sm">
                        Link Bank Card
                      </button>
                    </div>
                    <div class="col-auto">
                      <button (click)="linkBankCardOrStatement('statement')" class="btn btn-outline-dark btn-sm">
                        Link Bank Statement
                      </button>
                    </div>
                    <div class="col-auto">
                      <button class="btn btn-outline-dark btn-sm"
                        (click)="openPerformUnderwritingModal('repayment')">Add Repayment</button>
                    </div>
                    <div class="col-auto">
                      <!-- <button class="btn btn-outline-dark btn-sm"
                        (click)="openPerformUnderwritingModal('underwriting')">Perform
                        Underwriting</button> -->
                        <button class="btn btn-outline-dark btn-sm"
                        (click)="openPerformUnderwritingModal('underwriting')">Move to Active</button>
                    </div>
                    <div class="col-auto">
                      <button class="btn btn-outline-dark btn-sm" (click)="openExportTransactionsModal()">Export
                        Transactions</button>
                    </div>
                  </ng-container>
                </div>
                <hr>
              </div>
              <div class="w-100 w-300 px-1">
                <h6 class="text-primary">User Details</h6>
                <div class="row my-3">
                  <div class="col-md-4">
                    <dt class="text-black-50 text-capitalize whitespace-nowrap">
                      kwikee ID
                    </dt>
                    <dd class="text--500 text--deep-black text-break">
                      {{userDetails?.reference}}
                    </dd>
                  </div>
                  <div class="col-md-4">
                    <dt class="text-black-50 text-capitalize whitespace-nowrap">
                      email address
                    </dt>
                    <dd class="text--500  text--deep-black text-break">
                      {{userDetails?.email}}
                    </dd>
                  </div>
                  <div class="col-md-4">
                    <dt class="text-black-50 text-capitalize whitespace-nowrap">
                      phone number
                    </dt>
                    <dd class="text--500 text--deep-black text-break">
                      {{userDetails?.telephone}}
                    </dd>
                  </div>
                </div>
                <div class="row my-3">
                  <div class="col-md-4">
                    <dt class="text-black-50 text-capitalize whitespace-nowrap">
                      BVN
                    </dt>
                    <dd class="text--500 text--deep-black text-break">
                      {{userDetails.bvn ? userDetails.bvn: '-'}}
                    </dd>
                  </div>
                  <div class="col-md-4">
                    <dt class="text-black-50 text-capitalize whitespace-nowrap">
                      phone number
                    </dt>
                    <dd class="text--500 text--deep-black text-break">
                      {{userDetails?.telephone}}
                    </dd>
                  </div>
                  <div class="col-md-4">
                    <dt class="text-black-50 text-capitalize whitespace-nowrap">
                      Date of Birth
                    </dt>
                    <dd class="text--500 text--deep-black text-break">
                      {{ userDetails?.dob? (userDetails?.dob | date): '-' }}
                    </dd>
                  </div>
                </div>
                <div class="row my-3">
                  <div class="col-md-4">
                    <dt class="text-black-50 text-capitalize whitespace-nowrap">
                      User Pin
                    </dt>
                    <dd class="text--500 text--deep-black text-break">
                      {{userDetails && userDetails.show_pin == 1? userDetails?.pin: '****'}}
                    </dd>
                  </div>
                  <div class="col-md-4">
                    <dt class="text-black-50 text-capitalize whitespace-nowrap">
                      bankname
                    </dt>
                    <dd class="text--500 text--deep-black text-break">
                      {{(userDetails?.payment_bank_name?
                          userDetails?.payment_bank_name: '-') | titlecase}}
                    </dd>
                  </div>
                  <div class="col-md-4">
                    <dt class="text-black-50 text-capitalize whitespace-nowrap">
                      accountnumber
                    </dt>
                    <dd class="text--500 text--deep-black text-break">
                      {{ userDetails?.payment_account_number?
                          userDetails?.payment_account_number : '-' }}
                    </dd>
                  </div>
                </div>
                <div class="row my-3">
                  <div class="col-md-4">
                    <dt class="text-black-50 text-capitalize whitespace-nowrap">
                      Account Verification
                    </dt>
                    <dd class="text--500 text--deep-black text-break">
                      <span *ngIf="userDetails.verified == '1'" class="badge bg-success py-2 px-3">Verified</span>
                      <span *ngIf="userDetails.verified == '0'" class="badge bg-secondary py-2 px-3">Not Verified</span>
                    </dd>
                  </div>
                  <div class="col-md-4">
                    <dt class="text-black-50 text-capitalize whitespace-nowrap">
                      joined
                    </dt>
                    <dd class="text--500 text--deep-black text-break">
                      {{userDetails?.created_at | date}}
                    </dd>
                  </div>
                  <div class="col-md-4">
                    <dt class="text-black-50 text-capitalize whitespace-nowrap">
                      residential address
                    </dt>
                    <dd class="text--500 text--deep-black text-break">
                      {{creditDetails?.residential_address | titlecase}}
                    </dd>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="card mb-4">
            <div class="card-body">
              <div class="w-100 w-300 px-1">
                <h6 class="text-primary">Loan Details</h6>
                <div class="row my-3">
                  <div class="col-md-4">
                    <dt class="text-black-50 text-capitalize whitespace-nowrap">
                      status
                    </dt>
                    <dd class="text--500 text--deep-black text-break">
                      <span *ngIf="recentCredit.status == '-1'" class="badge bg-secondary py-2 px-3">
                        Incomplete Applications
                      </span>
                      <span *ngIf="recentCredit.status == '0'" class="badge bg-primary py-2 px-3">
                        New applications/awaiting payment
                      </span>
                      <span *ngIf="recentCredit.status == '99'" class="badge bg-primary py-2 px-3">
                        New applications/awaiting payment(off queue)
                      </span>
                      <span *ngIf="recentCredit.status == '1'" class="badge bg-success py-2 px-3">
                        Active Applications
                      </span>
                      <span *ngIf="recentCredit.status == '2'" class="badge bg-secondary py-2 px-3">
                        Non performing credit
                      </span>
                      <span *ngIf="recentCredit.status == '3'" class="badge bg-primary py-2 px-3">
                        Default Applications
                      </span>
                      <span *ngIf="recentCredit.status == '-3'" class="badge bg-danger py-2 px-3">
                        Rejected
                      </span>
                    </dd>
                  </div>
                  <div class="col-md-4">
                    <dt class="text-black-50 text-capitalize whitespace-nowrap">
                      wallet balance
                    </dt>
                    <dd class="text--500 text--deep-black text-break">
                      {{(recentCredit ? recentCredit.balance: 0) | currency: '₦'}}
                    </dd>
                  </div>
                  <div class="col-md-4">
                    <dt class="text-black-50 text-capitalize whitespace-nowrap">
                      credit limit
                    </dt>
                    <dd class="text--500 text--deep-black text-break">
                      {{(recentCredit.loan_amount ? recentCredit.loan_amount: 0) | currency: '₦'}}
                    </dd>
                  </div>
                </div>
                <div class="row my-3">
                  <!-- <div class="col-md-4">
                    <dt class="text-black-50 text-capitalize whitespace-nowrap">
                      payback amount
                    </dt>
                    <dd class="text--500 text--deep-black text-break">
                      {{(recentCredit.wallet_history?.payback_amount ? recentCredit.wallet_history?.payback_amount: 0) | currency: '₦'}}
                    </dd>
                  </div> -->
                  <div class="col-md-4">
                    <dt class="text-black-50 text-capitalize whitespace-nowrap">
                      amount Withdrawn
                    </dt>
                    <dd class="text--500 text--deep-black text-break">
                      {{(recentCredit.amount_withdrawn ? recentCredit.amount_withdrawn: 0) | currency: '₦'}}
                    </dd>
                  </div>
                  <div class="col-md-4">
                    <dt class="text-black-50 text-capitalize whitespace-nowrap">
                      interest due
                    </dt>
                    <dd class="text--500 text--deep-black text-break">
                      {{ (recentCredit.interest_outstanding  ? recentCredit.interest_outstanding :0)|currency : '₦'}}
                    </dd>
                  </div>
                  <div class="col-md-4">
                    <dt class="text-black-50 text-capitalize whitespace-nowrap">
                      repayment due date
                    </dt>
                    <dd class="text--500 text--deep-black text-break">
                      {{recentCredit.repayment_date ? recentCredit.repayment_date: 'N/A'}}
                    </dd>
                  </div>
                </div>
                <div class="row my-3">
                  <!-- <div class="col-md-4">
                    <dt class="text-black-50 text-capitalize whitespace-nowrap">
                      status
                    </dt>
                    <dd class="text--500 text--deep-black text-break">
                      <span *ngIf="creditHistory.status == '-1'" class="badge bg-secondary py-2 px-3">
                        Incomplete Applications
                      </span>
                      <span *ngIf="creditHistory.status == '0'" class="badge bg-primary py-2 px-3">
                        New applications/awaiting payment
                      </span>
                      <span *ngIf="creditHistory.status == '1'" class="badge bg-success py-2 px-3">
                        Active Applications
                      </span>
                      <span *ngIf="creditHistory.status == '2'" class="badge bg-secondary py-2 px-3">
                        Non performing credit
                      </span>
                      <span *ngIf="creditHistory.status == '3'" class="badge bg-primary py-2 px-3">
                        Default Applications
                      </span>
                      <span *ngIf="creditHistory.status == '5'" class="badge bg-primary py-2 px-3">
                        Pending Underwriting
                      </span>
                    </dd>
                  </div> -->
                  <div *ngIf="recentCredit.status == '0' || recentCredit.status == '5' || recentCredit.status == '-3'" class="col-md-4">
                    <dt class="text-black-50 text-capitalize whitespace-nowrap">
                      cron error
                    </dt>
                    <dd class="text--500 text--deep-black text-break">
                      {{userDetails.cron_error ? userDetails.cron_error : "-" }}
                    </dd>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="card mb-4">
            <div class="card-body">
              <div class="w-100 w-300 px-1">
                <h6 class="text-primary">Employment Details</h6>
                <div class="row my-3">
                  <div class="col-md-4">
                    <dt class="text-black-50 text-capitalize whitespace-nowrap">
                      employer
                    </dt>
                    <dd class="text--500 text--deep-black text-break text-capitalize">
                      {{creditDetails.employer_id ? (creditDetails.company?.company_name ? creditDetails.company?.company_name : '-') : (creditDetails.employer_name ? creditDetails.employer_name : '-') }}
                    </dd>
                  </div>
                  <div class="col-md-4">
                    <dt class="text-black-50 text-capitalize whitespace-nowrap">
                      employment type
                    </dt>
                    <dd class="text--500 text--deep-black text-break">
                      {{creditDetails.employment_status ? creditDetails.employment_status: '-'}}
                    </dd>
                  </div>
                  <div class="col-md-4">
                    <dt class="text-black-50 text-capitalize whitespace-nowrap">
                      employer address
                    </dt>
                    <dd class="text--500 text--deep-black text-break">
                      {{creditDetails.employer_address ? creditDetails.employer_address : '-'}}
                    </dd>
                  </div>
                </div>
                <div class="row my-3">
                  <div class="col-md-4">
                    <dt class="text-black-50 text-capitalize whitespace-nowrap">
                      official email
                    </dt>
                    <dd class="text--500 text--deep-black text-break">
                      {{creditDetails.official_email? creditDetails.official_email: '-'}}
                    </dd>
                  </div>
                  <div class="col-md-4">
                    <dt class="text-black-50 text-capitalize whitespace-nowrap">
                      salary bank
                    </dt>
                    <dd class="text--500 text--deep-black text-break">
                      {{creditDetails.income_account_bankcode | bankName}}
                    </dd>
                  </div>
                  <div class="col-md-4">
                    <dt class="text-black-50 text-capitalize whitespace-nowrap">
                      salary account number
                    </dt>
                    <dd class="text--500 text--deep-black text-break">
                      {{creditDetails.income_account_number ? creditDetails.income_account_number: '-'}}
                    </dd>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="card mb-4">
            <div class="card-body">
              <div class="w-100 w-300 px-1">
                <h6 class="text-primary">Next Of Kin Details</h6>
                <div class="row my-3">
                  <div class="col-md-4">
                    <dt class="text-black-50 text-capitalize whitespace-nowrap">
                      name
                    </dt>
                    <dd class="text--500 text--deep-black text-break text-capitalize">
                      {{creditDetails.next_kin_name ? creditDetails.next_kin_name: '-'}}
                    </dd>
                  </div>
                  <div class="col-md-4">
                    <dt class="text-black-50 text-capitalize whitespace-nowrap">
                      relationship
                    </dt>
                    <dd class="text--500 text--deep-black text-break">
                      {{creditDetails.next_kin_relationship ? creditDetails.next_kin_relationship: '-'}}
                    </dd>
                  </div>
                  <div class="col-md-4">
                    <dt class="text-black-50 text-capitalize whitespace-nowrap">
                      phone number
                    </dt>
                    <dd class="text--500 text--deep-black text-break">
                      {{creditDetails.next_kin_telephone ? creditDetails.next_kin_telephone: '-'}}
                    </dd>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-sm-12">
          <ul class="main-tab-card nav nav-pills" id="myTab" role="tablist">
            <li class="nav-item me-2" role="presentation">
              <button class="nav-link active" id="bvn-tab" data-bs-toggle="tab" data-bs-target="#bvn" type="button"
                role="tab" aria-controls="bvn" aria-selected="true">BVN Data</button>
            </li>
            <li class="nav-item me-2" role="presentation">
              <button (click)="fetchCreditHistory()" class="nav-link" id="transactions-tab" data-bs-toggle="tab" data-bs-target="#transactions"
                type="button" role="tab" aria-controls="transactions" aria-selected="false">Credit History</button>
            </li>
            <li class="nav-item me-2" role="presentation">
              <button class="nav-link" id="documents-tab" data-bs-toggle="tab" data-bs-target="#documents" type="button"
                role="tab" aria-controls="documents" aria-selected="false">Loan Documents</button>
            </li>
            <li class="nav-item me-2" role="presentation">
              <button class="nav-link" id="fraudchecklist-tab" data-bs-toggle="tab" data-bs-target="#fraudchecklist"
                type="button" role="tab" aria-controls="fraudchecklist" aria-selected="false">Anti-Fraud
                Checklist</button>
            </li>
            <li class="nav-item me-2" role="presentation">
              <button class="nav-link" id="underwritingchecklist-tab" data-bs-toggle="tab"
                data-bs-target="#underwritingchecklist" type="button" role="tab" aria-controls="underwritingchecklist"
                aria-selected="false">
                Underwriting Checklist</button>
            </li>
            <li class="nav-item me-2" role="presentation">
              <button class="nav-link" id="authcards-tab" data-bs-toggle="tab" data-bs-target="#authcards" type="button"
                role="tab" aria-controls="authcards" aria-selected="false">
                Authorised Cards</button>
            </li>
          </ul>

          <!-- Tab panes -->
          <div class="tab-content">
            <div class="tab-pane active" id="bvn" role="tabpanel" aria-labelledby="bvn-tab" tabindex="0">
              <div class="card mt-3">
                <div class="card-body">
                  <div class="row g-2">
                    <div class="col-auto">
                      <button (click)="performFaceMatch()" class="btn btn-outline-dark btn-sm">
                        Do Face Match
                      </button>
                    </div>
                  </div>
                  <hr>
                  <div class="w-100 w-300 px-1">
                    <div class="row my-3">
                      <div class="col-8">
                        <dt class="text-black-50 text-capitalize whitespace-nowrap">
                          full name
                        </dt>
                        <dd class="text--500 text--deep-black text-break text-capitalize">
                          {{userDetails.title}}&nbsp;{{bvnData.firstName}}&nbsp;{{bvnData.middleName}}&nbsp;{{bvnData.lastName}}
                        </dd>
                      </div>
                      <div class="col-md-4">
                        <dt class="text-black-50 text-capitalize whitespace-nowrap">
                          watchlisted
                        </dt>
                        <dd class="text--500 text--deep-black text-break">
                          {{bvnData.watchListed}}
                        </dd>
                      </div>
                    </div>
                    <div class="row my-3">
                      <div class="col-md-4">
                        <dt class="text-black-50 text-capitalize whitespace-nowrap">
                          name on card
                        </dt>
                        <dd class="text--500 text--deep-black text-break text-capitalize">
                          {{bvnData.nameOnCard ? bvnData.nameOnCard: '-'}}
                        </dd>
                      </div>
                      <div class="col-md-4">
                        <dt class="text-black-50 text-capitalize whitespace-nowrap">
                          dob
                        </dt>
                        <dd class="text--500 text--deep-black text-break">
                          {{bvnData.dateOfBirth ? bvnData.dateOfBirth: '-'}}
                        </dd>
                      </div>
                      <div class="col-md-4">
                        <dt class="text-black-50 text-capitalize whitespace-nowrap">
                          gender
                        </dt>
                        <dd class="text--500 text--deep-black text-break">
                          {{bvnData.gender ? (bvnData.gender | titlecase): '-'}}
                        </dd>
                      </div>
                    </div>
                    <div class="row my-3">
                      <div class="col-md-4">
                        <dt class="text-black-50 text-capitalize whitespace-nowrap">
                          nationality
                        </dt>
                        <dd class="text--500 text--deep-black text-break text-capitalize">
                          {{bvnData.nationality ? bvnData.nationality: '-'}}
                        </dd>
                      </div>
                      <div class="col-md-4">
                        <dt class="text-black-50 text-capitalize whitespace-nowrap">
                          address
                        </dt>
                        <dd class="text--500 text--deep-black text-break">
                          {{bvnData.residentialAddress ? bvnData.residentialAddress: '-'}}
                        </dd>
                      </div>
                      <div class="col-md-4">
                        <dt class="text-black-50 text-capitalize whitespace-nowrap">
                          state of origin
                        </dt>
                        <dd class="text--500 text--deep-black text-break">
                          {{bvnData.stateOfOrigin ? bvnData.stateOfOrigin: '-'}}
                        </dd>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="tab-pane" id="transactions" role="tabpanel" aria-labelledby="transactions-tab" tabindex="0">
              <loading-spinner style="min-height: 300px" [spinning]="loadingCredit">
                <div class="card mt-3">
                  <div class="card-body mt-3">
                    <div class="table-responsive">
                      <table class="table">
                        <thead class="bg-light text-capitalize">
                          <tr>
                            <th scope="col">

                            </th>
                            <th scope="col">
                              Date
                            </th>
                            <th scope="col">
                              Balance
                            </th>
                            <th scope="col">
                              Amount
                            </th>
                            <th scope="col">
                              Amount withdrawn
                            </th>
                            <th scope="col">
                              Interest Accrued
                            </th>
                          </tr>
                        </thead>
                        <tbody>
                          <ng-container *ngIf="creditHistory.length; else noTableData">
                            <tr *ngFor="let credit of creditHistory">
                              <td>
                                <button (click)="openTransactionHistoryModal(credit.credit_id)" class="btn btn-sm btn-action" type="button">
                                  View
                                </button>
                              </td>
                              <td>
                                {{credit?.repayment_date ? (credit?.repayment_date | date): 'N/A'}}
                              </td>
                              <td>
                                {{credit?.balance | currency: '₦'}}
                              </td>
                              <td>
                                {{credit?.loan_amount | currency: '₦'}}
                              </td>
                              <td>
                                {{credit?.amount_withdrawn| currency: '₦'}}
                              </td>
                              <td>
                                {{credit?.interest_outstanding | currency: '₦'}}
                              </td>
                            </tr>
                          </ng-container>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </loading-spinner>
            </div>
            <div class="tab-pane" id="documents" role="tabpanel" aria-labelledby="documents-tab" tabindex="0">
              <div class="card mt-3">
                <div class="card-body mt-3">
                  <div class="row g-2 mb-3">
                    <ng-container *ngIf="creditDetails.documents_link && creditDetails.documents_link.length; else noDocuments">
                      <div class="col-auto" *ngFor="let document of creditDetails.documents_link">
                        <a [href]="document.link" class="btn btn-light text-capitalize"
                          target="_blank">{{document.name}}&nbsp;<i class="ri-external-link-fill"></i></a>
                      </div>
                    </ng-container>
                    <ng-template #noDocuments>
                      <div class="col text-center">
                        No document
                      </div>
                    </ng-template>
                  </div>
                </div>
              </div>
            </div>
            <div class="tab-pane" id="fraudchecklist" role="tabpanel" aria-labelledby="fraudchecklist-tab" tabindex="0">
              <div class="card mt-3">
                <div class="card-body mt-3">
                  <div class="w-100 w-300 px-1">
                    <div class="row my-3">
                      <div class="col-6">
                        <dt class="text-black-50 text-capitalize whitespace-nowrap">
                          date
                        </dt>
                        <dd class="text--500 text--deep-black text-break text-capitalize">
                          {{antiFraudChecklist.created_at | date}}
                        </dd>
                      </div>
                      <div class="col-6">
                        <dt class="text-black-50 text-capitalize whitespace-nowrap">
                          face match
                        </dt>
                        <dd class="text--500 text--deep-black text-break">
                          <ng-container *ngIf="antiFraudChecklist.face_match == '0'">
                            <svg xmlns="http://www.w3.org/2000/svg"
                            width="16" height="16" fill="#f53d3d" viewBox="0 0 16 16">
                            <path
                              d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM5.354 4.646a.5.5 0 1 0-.708.708L7.293 8l-2.647 2.646a.5.5 0 0 0 .708.708L8 8.707l2.646 2.647a.5.5 0 0 0 .708-.708L8.707 8l2.647-2.646a.5.5 0 0 0-.708-.708L8 7.293 5.354 4.646z" />
                          </svg>
                          <br>
                          <small>{{creditDetails.facematch_check_message}}</small>
                          </ng-container>
                          <svg *ngIf="antiFraudChecklist.face_match == '1'" xmlns="http://www.w3.org/2000/svg"
                            width="16" height="16" fill="#34af23" viewBox="0 0 16 16">
                            <path
                              d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z" />
                          </svg>
                        </dd>
                      </div>
                    </div>
                    <div class="row my-3">
                      <div class="col-6">
                        <dt class="text-black-50 text-capitalize whitespace-nowrap">
                          credit report check
                        </dt>
                        <dd class="text--500 text--deep-black text-break text-capitalize">
                          <ng-container *ngIf="antiFraudChecklist.credit_report_check == '0'">
                            <button class="btn btn-outline-dark btn-sm"
                              (click)="performAntiFraudCheck({credit_report_check: '1'})">
                              Check
                            </button>
                            <br>
                          </ng-container>
                          <svg *ngIf="antiFraudChecklist.credit_report_check == '-1'" xmlns="http://www.w3.org/2000/svg"
                            width="16" height="16" fill="#f53d3d" viewBox="0 0 16 16">
                            <path
                              d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM5.354 4.646a.5.5 0 1 0-.708.708L7.293 8l-2.647 2.646a.5.5 0 0 0 .708.708L8 8.707l2.646 2.647a.5.5 0 0 0 .708-.708L8.707 8l2.647-2.646a.5.5 0 0 0-.708-.708L8 7.293 5.354 4.646z" />
                          </svg>
                          <svg *ngIf="antiFraudChecklist.credit_report_check == '1'" xmlns="http://www.w3.org/2000/svg"
                            width="16" height="16" fill="#34af23" viewBox="0 0 16 16">
                            <path
                              d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z" />
                          </svg>
                          <br>
                          <small>{{creditDetails?.credit_check_message}}</small>
                        </dd>
                      </div>
                      <div class="col-6">
                        <dt class="text-black-50 text-capitalize whitespace-nowrap">
                          bvn verified
                        </dt>
                        <dd class="text--500 text--deep-black text-break">
                          <ng-container *ngIf="antiFraudChecklist.credit_report_check == '0'">
                            <button class="btn btn-outline-dark btn-sm" (click)="performAntiFraudCheck({is_bvn_verified: '1'})">
                              Check
                            </button>
                            <br>
                          </ng-container>
                          <svg *ngIf="antiFraudChecklist.is_bvn_verified == '1'" xmlns="http://www.w3.org/2000/svg"
                            width="16" height="16" fill="#34af23" viewBox="0 0 16 16">
                            <path
                              d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z" />
                          </svg>
                        </dd>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="tab-pane" id="underwritingchecklist" role="tabpanel" aria-labelledby="underwritingchecklist-tab"
              tabindex="0">
              <div class="card mt-3">
                <div class="card-body mt-3">
                  <div class="w-100 w-300 px-1">
                   <ng-container *ngIf="underwritingChecklist; else showNodata">
                    <div class="row my-3">
                      <div class="col-md-4">
                        <dt class="text-black-50 text-capitalize whitespace-nowrap">
                          date
                        </dt>
                        <dd class="text--500 text--deep-black text-break text-capitalize">
                          {{underwritingChecklist?.created_at | date}}
                        </dd>
                      </div>
                      <div class="col-4">
                        <dt class="text-black-50 text-capitalize whitespace-nowrap">
                          official email verified
                        </dt>
                        <dd class="text--500 text--deep-black text-break">
                          <ng-container *ngIf="antiFraudChecklist?.credit_report_check == '0'">
                            <button class="btn btn-outline-dark btn-sm"
                              (click)="performUnderwritingCheck({official_email_verified: '1'})">
                              Check
                            </button>
                            <br>
                          </ng-container>
                          <svg *ngIf="underwritingChecklist?.official_email_verified == '1'"
                            xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#34af23"
                            viewBox="0 0 16 16">
                            <path
                              d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z" />
                          </svg>
                        </dd>
                      </div>
                      <div class="col-4">
                        <dt class="text-black-50 text-capitalize whitespace-nowrap">
                          repayment instrument correct
                        </dt>
                        <dd class="text--500 text--deep-black text-break text-capitalize">
                          <ng-container *ngIf="underwritingChecklist?.repayment_instrument_correct == '0'">
                            <button class="btn btn-outline-dark btn-sm"
                              (click)="performUnderwritingCheck({repayment_instrument_correct: '1'})">
                              Check
                            </button>
                            <br>
                          </ng-container>
                          <svg *ngIf="underwritingChecklist.repayment_instrument_correct == '1'"
                            xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#34af23"
                            viewBox="0 0 16 16">
                            <path
                              d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z" />
                          </svg>
                          <br>
                          <small>{{userDetails.credit_underwriting?.credit_check_message}}</small>
                        </dd>
                      </div>
                    </div>
                    <div class="row my-3">
                      <div class="col-4">
                        <dt class="text-black-50 text-capitalize whitespace-nowrap">
                          ID card verified
                        </dt>
                        <dd class="text--500 text--deep-black text-break text-capitalize">
                          <ng-container *ngIf="userDetails.credit_underwriting?.verify_idcard == '0'">
                            <button class="btn btn-outline-dark btn-sm" (click)="performIDCardCheck()">
                              Check
                            </button>
                            <br>
                          </ng-container>
                          <svg *ngIf="userDetails?.credit_underwriting?.verify_idcard == '-1'" xmlns="http://www.w3.org/2000/svg" width="16"
                            height="16" fill="#f53d3d" viewBox="0 0 16 16">
                            <path
                              d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM5.354 4.646a.5.5 0 1 0-.708.708L7.293 8l-2.647 2.646a.5.5 0 0 0 .708.708L8 8.707l2.646 2.647a.5.5 0 0 0 .708-.708L8.707 8l2.647-2.646a.5.5 0 0 0-.708-.708L8 7.293 5.354 4.646z" />
                          </svg>
                          <svg *ngIf="userDetails.credit_underwriting?.verify_idcard == '1'" xmlns="http://www.w3.org/2000/svg" width="16"
                            height="16" fill="#34af23" viewBox="0 0 16 16">
                            <path
                              d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z" />
                          </svg>
                          <br>
                          <small>{{userDetails.credit_underwriting?.credit_check_message}}</small>
                        </dd>
                      </div>
                      <div class="col-4">
                        <dt class="text-black-50 text-capitalize whitespace-nowrap">
                          card setup
                        </dt>
                        <dd class="text--500 text--deep-black text-break">
                          <ng-container *ngIf="userDetails?.card_setup == '0'">
                            <button class="btn btn-outline-dark btn-sm" (click)="performUnderwritingCheck({card_setup: '1'})">
                              Check
                            </button>
                            <br>
                          </ng-container>
                          <svg *ngIf="userDetails?.card_setup == '1'" xmlns="http://www.w3.org/2000/svg" width="16"
                            height="16" fill="#34af23" viewBox="0 0 16 16">
                            <path
                              d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z" />
                          </svg>
                        </dd>
                      </div>
                      <!-- <div class="col-4">
                        <dt class="text-black-50 text-capitalize whitespace-nowrap">
                          bank statement setup
                        </dt>
                        <dd class="text--500 text--deep-black text-break">
                          <ng-container *ngIf="creditDetails.bank_statement_setup == '0'">
                            <button class="btn btn-outline-dark btn-sm"
                              (click)="performUnderwritingCheck({bank_statement_setup: '1'})">
                              Check
                            </button>
                            <br>
                          </ng-container>
                          <svg *ngIf="creditDetails.bank_statement_setup == '1'" xmlns="http://www.w3.org/2000/svg"
                            width="16" height="16" fill="#34af23" viewBox="0 0 16 16">
                            <path
                              d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z" />
                          </svg>
                        </dd>
                      </div> -->
                    </div>
                   </ng-container>
                  </div>
                </div>
              </div>
            </div>
            <div class="tab-pane" id="authcards" role="tabpanel" aria-labelledby="authcards-tab" tabindex="0">
              <div class="card mt-3">
                <div class="card-body mt-3">
                  <div class="row g-2">
                    <div class="col-auto">
                      <button class="btn btn-sm btn-outline-dark" (click)="requestNewAuthorization()">Request new
                        authorization</button>
                    </div>
                    <div class="col-auto">
                      <button (click)="openChargeCustomerModal()" class="btn btn-sm btn-outline-dark">Charge
                        Customer</button>
                    </div>
                  </div>
                  <hr>
                  <div class="table-responsive">
                    <table class="table">
                      <thead class="bg-light text-capitalize">
                        <tr>
                          <th scope="col">

                          </th>
                          <th scope="col">
                            Account Name
                          </th>
                          <th scope="col">
                            Bank
                          </th>
                          <th scope="col">
                            Card Type
                          </th>
                          <th scope="col">
                            Expiry
                          </th>
                          <th scope="col">
                            Last 4
                          </th>
                        </tr>
                      </thead>
                      <tbody>
                        <ng-container *ngIf="authCards && authCards.length; else noTableData">
                          <tr *ngFor="let item of authCards; let index = index">
                            <td>
                              <button class="btn btn-sm btn-outline-danger"
                                (click)="deleteCardAuthorization(item?.last4)">Delete</button>
                            </td>
                            <td>
                              {{item?.account_name ? item?.account_name : '-' }}
                            </td>
                            <td>
                              {{item?.bank}}
                            </td>
                            <td>
                              {{item?.card_type}}
                            </td>
                            <td>
                              {{item?.exp_month}}/{{item?.exp_year}}
                            </td>
                            <td>
                              {{item?.last4}}
                            </td>
                          </tr>
                        </ng-container>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </ng-container>
  </loading-spinner>
</div>


<ng-template #showNodata>
  <tr>
    <td colspan="100%">
      <div class="p-3 d-flex align-items-center flex-column justify-content-center">
        <svg style="width: 1.5rem; height: 1.5rem" fill="none" stroke="currentColor" viewBox="0 0 24 24"
          xmlns="http://www.w3.org/2000/svg">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10">
          </path>
        </svg>
        <span style="font-size: 14px">
          No data
        </span>
      </div>
    </td>
  </tr>
</ng-template>

<ng-template #showNoLoan>
  <div class="card">
    <div class="card-body">
      <div class="p-5 d-flex align-items-center flex-column justify-content-center" style="min-height: 500px;">
        <svg style="width: 1.5rem; height: 1.5rem" fill="none" stroke="currentColor" viewBox="0 0 24 24"
          xmlns="http://www.w3.org/2000/svg">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10">
          </path>
        </svg>
        <span style="font-size: 14px">
          No credit application found
        </span>
      </div>
    </div>
  </div>
</ng-template>

<ng-template #noTableData>
  <tr>
    <td colspan="100%">
      <div class="p-3 text-center">
        No data
      </div>
    </td>
  </tr>
</ng-template>

<div class="modal fade" id="rejectModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content card custom-modal">
      <div class="card-body">
        <i (click)="closeRejectOrCancelModal()" role="button" aria-label="Close" class="ri-close-line close-modal"></i>
        <h5 class="modal-title text-capitalize">{{rejectOrCancelAction}} Application</h5>
        <div class="modal-body">
          <!-- <div class="greetings-area mb-2">
            <h6>Enter your reason</h6>
          </div> -->
          <form action="form-group">
            <div class="position-relative pt-1 pb-4 mb-2">
              <fieldset class="form-control mb-0">
                <legend>Reason</legend>
                <textarea [formControl]="reasonControl" name="reason" rows="3" class="w-100"></textarea>
              </fieldset>
              <ng-container *ngIf="(reasonControl.dirty || reasonControl.touched) && reasonControl.errors">
                <small *ngIf="reasonControl.errors['required']" class="text-danger text-xs">Enter a reason</small>
              </ng-container>
            </div>
            <button type="button" [disabled]="isRejecting" (click)="rejectOrCancelLoan()"
              class="btn btn-purple btn-block w-100">
              <div *ngIf="isRejecting" class="spinner-border spinner-border-sm" role="status">
                <span class="visually-hidden">Loading...</span>
              </div>
              <span *ngIf="!isRejecting">
                Proceed
              </span>
            </button>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="uploadDocumentModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content card custom-modal">
      <div class="card-body">
        <i (click)="closeUploadDocumentsModal()" role="button" aria-label="Close" class="ri-close-line close-modal"></i>
        <h5 class="modal-title text-capitalize">Upload Document</h5>
        <div class="modal-body">
          <form [formGroup]="uploadDocumentsForm" action="form-group">
            <div class="position-relative pt-1 pb-4 mb-2">
              <fieldset class="form-control mb-0">
                <legend>Document Type</legend>
                <select formControlName="type" name="type">
                  <option [value]="null" selected disabled>Select Document Type</option>
                  <option value="1">Government ID</option>
                  <option value="2">Work ID</option>
                  <option value="0">Other ID</option>
                </select>
              </fieldset>
              <ng-container
                *ngIf="(uploadDocumentsForm.controls['type'].dirty || uploadDocumentsForm.controls['type'].touched) && uploadDocumentsForm.controls['type'].errors">
                <small *ngIf="uploadDocumentsForm.controls['type'].errors['required']"
                  class="text-danger text-xs">Select a type</small>
              </ng-container>
            </div>
            <ng-container *ngIf="uploadDocumentsForm.get('type')?.value == '0'">
              <div class="position-relative pt-1 pb-4 mb-2">
                <fieldset class="form-control mb-0">
                  <legend>Select Document</legend>
                  <input formControlName="otherDocumentName" type="text">
                </fieldset>
                <ng-container
                  *ngIf="(uploadDocumentsForm.controls['otherDocumentName'].dirty || uploadDocumentsForm.controls['otherDocumentName'].touched) && uploadDocumentsForm.controls['otherDocumentName'].errors">
                  <small *ngIf="uploadDocumentsForm.controls['otherDocumentName'].errors['required']"
                    class="text-danger text-xs">Enter document name</small>
                </ng-container>
              </div>
            </ng-container>
            <div class="position-relative pt-1 pb-4 mb-2">
              <fieldset class="form-control mb-0">
                <legend>Select Document</legend>
                <input accept="image/png, image/jpg, image/jpeg, application/pdf, image/*" #documentInput
                  (change)="onFileChanged($event)" formControlName="file" type="file">
              </fieldset>
              <ng-container
                *ngIf="(uploadDocumentsForm.controls['file'].dirty || uploadDocumentsForm.controls['file'].touched) && uploadDocumentsForm.controls['file'].errors">
                <small *ngIf="uploadDocumentsForm.controls['file'].errors['required']"
                  class="text-danger text-xs">Select file</small>
              </ng-container>
            </div>
            <button [disabled]="isUploading" type="button" class="btn btn-purple w-100" (click)="uploadDocuments()">
              <div *ngIf="isUploading" class="spinner-border spinner-border-sm" role="status">
                <span class="visually-hidden">Loading...</span>
              </div>
              <span *ngIf="!isUploading">
                Upload
              </span>
            </button>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="performUnderwritingModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content card custom-modal">
      <div class="card-body">
        <i (click)="closePerformUnderwritingModal()" role="button" aria-label="Close"
          class="ri-close-line close-modal"></i>
        <h5 class="modal-title text-capitalize">
          {{repayOrUnderwriting == 'underwriting'?  'Perform Underwriting': 'Add Repayment'}}</h5>
        <div class="modal-body">
          <form [formGroup]="underwritingForm" action="">
            <div class="position-relative pt-1 pb-4 mb-2">
              <fieldset class="form-control mb-0">
                <legend>Amount</legend>
                <input type="number" name="amount" formControlName="amount">
              </fieldset>
              <ng-container
                *ngIf="(underwritingForm.controls['amount'].dirty || underwritingForm.controls['amount'].touched) && underwritingForm.controls['amount'].errors">
                <small *ngIf="underwritingForm.controls['amount'].errors['required']"
                  class="text-danger text-xs">Enter amount</small>
              </ng-container>
            </div>
            <div class="position-relative pt-1 pb-4 mb-2">
              <fieldset class="form-control mb-0">
                <legend>Pay Date</legend>
                <input type="date" name="pay_date" formControlName="pay_date">
              </fieldset>
              <ng-container
                *ngIf="(underwritingForm.controls['pay_date'].dirty || underwritingForm.controls['pay_date'].touched) && underwritingForm.controls['pay_date'].errors">
                <small *ngIf="underwritingForm.controls['pay_date'].errors['required']"
                  class="text-danger text-xs">Select date</small>
              </ng-container>
            </div>
            <button [disabled]="isLoading" type="button" class="btn btn-purple w-100"
              (click)="performUnderwriting()">
              <div *ngIf="isLoading" class="spinner-border spinner-border-sm" role="status">
                <span class="visually-hidden">Loading...</span>
              </div>
              <span *ngIf="!isLoading">
                Proceed
              </span>
            </button>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="editLoanModal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content card custom-modal">
      <div class="card-body">
        <i (click)="closeEditLoanModal()" role="button" aria-label="Close" class="ri-close-line close-modal"></i>
        <h5 class="modal-title text-capitalize">Edit Application</h5>
        <div class="modal-body">
          <form [formGroup]="editLoanForm" action="">
            <div class="row">
              <div class="col-md-6 mb-3">
                <div class="position-relative pt-1 pb-4 mb-2">
                  <fieldset class="form-control mb-0">
                    <legend>Employer Name</legend>
                    <!-- <input type="text" [placeholder]="loadingCompanies? 'Fetching Companies': ''" name="employer_name"
                      formControlName="employer_name" list="companies">
                    <datalist id="companies">
                      <ng-container *ngFor="let item of allCompaniesData">
                        <option #selectItem [value]="item.company_id">{{item.company_name}}</option>
                      </ng-container>
                    </datalist> -->
                    <custom-select [disableControl]="loadingCompanies" [items]="allCompaniesData" formControlName="employer_name"></custom-select>
                  </fieldset>
                  <small *ngIf="loadingCompanies">Fetching Companies.. Please wait</small>
                  <ng-container
                    *ngIf="(editLoanForm.controls['employer_name'].dirty || editLoanForm.controls['employer_name'].touched) && editLoanForm.controls['employer_name'].errors">
                    <small *ngIf="editLoanForm.controls['employer_name'].errors['required']"
                      class="text-danger text-xs">Select employer</small>
                  </ng-container>
                </div>
              </div>
              <div class="col-md-6 mb-3">
                <div class="position-relative pt-1 pb-4 mb-2">
                  <fieldset class="form-control mb-0">
                    <legend>Employment Start Date</legend>
                    <input type="date" name="employment_start_date" formControlName="employment_start_date">
                  </fieldset>
                  <ng-container
                    *ngIf="(editLoanForm.controls['employment_start_date'].dirty || editLoanForm.controls['employment_start_date'].touched) && editLoanForm.controls['employment_start_date'].errors">
                    <small *ngIf="editLoanForm.controls['employment_start_date'].errors['required']"
                      class="text-danger text-xs">Select date</small>
                  </ng-container>
                </div>
              </div>
              <div class="col-md-6 mb-3">
                <div class="position-relative pt-1 pb-4 mb-2">
                  <fieldset class="form-control mb-0">
                    <legend>Work Email</legend>
                    <input type="email" name="official_email" formControlName="official_email">
                  </fieldset>
                  <ng-container
                    *ngIf="(editLoanForm.controls['official_email'].dirty || editLoanForm.controls['official_email'].touched) && editLoanForm.controls['official_email'].errors">
                    <small *ngIf="editLoanForm.controls['official_email'].errors['required']"
                      class="text-danger text-xs">Enter email</small>
                  </ng-container>
                </div>
              </div>
              <div class="col-md-6 mb-3">
                <div class="position-relative pt-1 pb-4 mb-2">
                  <fieldset class="form-control mb-0">
                    <legend>Salary Payment Date</legend>
                    <input type="number" name="pay_date" formControlName="pay_date">
                  </fieldset>
                  <ng-container
                    *ngIf="(editLoanForm.controls['pay_date'].dirty || editLoanForm.controls['pay_date'].touched) && editLoanForm.controls['pay_date'].errors">
                    <small *ngIf="editLoanForm.controls['pay_date'].errors['required']"
                      class="text-danger text-xs">Enter date</small>
                  </ng-container>
                </div>
              </div>
              <div class="col-md-6 mb-3">
                <div class="position-relative pt-1 pb-4 mb-2">
                  <fieldset class="form-control mb-0">
                    <legend>Personal Email</legend>
                    <input type="email" name="email" formControlName="email">
                  </fieldset>
                  <ng-container
                    *ngIf="(editLoanForm.controls['email'].dirty || editLoanForm.controls['email'].touched) && editLoanForm.controls['email'].errors">
                    <small *ngIf="editLoanForm.controls['email'].errors['required']" class="text-danger text-xs">Enter
                      email</small>
                  </ng-container>
                </div>
              </div>
              <div class="col-md-6 mb-3">
                <div class="position-relative pt-1 pb-4 mb-2">
                  <fieldset class="form-control mb-0">
                    <legend>Personal Phone Number</legend>
                    <input type="tel" name="telephone" formControlName="telephone">
                  </fieldset>
                  <ng-container
                    *ngIf="(editLoanForm.controls['telephone'].dirty || editLoanForm.controls['telephone'].touched) && editLoanForm.controls['telephone'].errors">
                    <small *ngIf="editLoanForm.controls['telephone'].errors['required']"
                      class="text-danger text-xs">Enter telephone</small>
                  </ng-container>
                </div>
              </div>
              <div class="col-md-12 mb-3">
                <div class="position-relative pt-1 pb-4 mb-2">
                  <fieldset class="form-control mb-0">
                    <legend>Work Address</legend>
                    <textarea name="employer_address" formControlName="employer_address" rows="3"></textarea>
                  </fieldset>
                  <ng-container
                    *ngIf="(editLoanForm.controls['employer_address'].dirty || editLoanForm.controls['employer_address'].touched) && editLoanForm.controls['employer_address'].errors">
                    <small *ngIf="editLoanForm.controls['employer_address'].errors['required']"
                      class="text-danger text-xs">Enter employer address</small>
                  </ng-container>
                </div>
              </div>
              <div class="col-md-6 mb-3">
                <div class="position-relative pt-1 pb-4 mb-2">
                  <fieldset class="form-control mb-0">
                    <legend>State</legend>
                    <input type="text" name="state_of_residence" formControlName="state_of_residence">
                  </fieldset>
                  <ng-container
                    *ngIf="(editLoanForm.controls['state_of_residence'].dirty || editLoanForm.controls['state_of_residence'].touched) && editLoanForm.controls['state_of_residence'].errors">
                    <small *ngIf="editLoanForm.controls['state_of_residence'].errors['required']"
                      class="text-danger text-xs">Enter state of residence</small>
                  </ng-container>
                </div>
              </div>
              <div class="col-md-6 mb-3">
                <div class="position-relative pt-1 pb-4 mb-2">
                  <fieldset class="form-control mb-0">
                    <legend>City</legend>
                    <input type="text" name="local_government" formControlName="local_government">
                  </fieldset>
                  <ng-container
                    *ngIf="(editLoanForm.controls['local_government'].dirty || editLoanForm.controls['local_government'].touched) && editLoanForm.controls['local_government'].errors">
                    <small *ngIf="editLoanForm.controls['local_government'].errors['required']"
                      class="text-danger text-xs">Enter city</small>
                  </ng-container>
                </div>
              </div>
              <div class="col-md-12 mb-3">
                <div class="position-relative pt-1 pb-4 mb-2">
                  <fieldset class="form-control mb-0">
                    <legend>House Address</legend>
                    <textarea name="house_address" formControlName="house_address" rows="3"></textarea>
                  </fieldset>
                  <ng-container
                    *ngIf="(editLoanForm.controls['house_address'].dirty || editLoanForm.controls['house_address'].touched) && editLoanForm.controls['house_address'].errors">
                    <small *ngIf="editLoanForm.controls['house_address'].errors['required']"
                      class="text-danger text-xs">Enter house address</small>
                  </ng-container>
                </div>
              </div>
              <div class="col-md-6 mb-3">
                <div class="position-relative pt-1 pb-4 mb-2">
                  <fieldset class="form-control mb-0">
                    <legend>Salary Bank Name</legend>
                    <select name="income_account_bankcode" formControlName="income_account_bankcode">
                      <option [value]="null" disabled>Select Bank</option>
                      <option *ngFor="let bank of banks" [value]="bank.code">
                        {{bank.name.toUpperCase()}}</option>
                    </select>
                  </fieldset>
                  <ng-container
                    *ngIf="(editLoanForm.controls['income_account_bankcode'].dirty || editLoanForm.controls['income_account_bankcode'].touched) && editLoanForm.controls['income_account_bankcode'].errors">
                    <small *ngIf="editLoanForm.controls['income_account_bankcode'].errors['required']"
                      class="text-danger text-xs">Select bank</small>
                  </ng-container>
                </div>
              </div>
              <div class="col-md-6 mb-3">
                <div class="position-relative pt-1 pb-4 mb-2">
                  <fieldset class="form-control mb-0">
                    <legend>Salary Account Number</legend>
                    <input type="tel" name="income_account_number" formControlName="income_account_number">
                  </fieldset>
                  <ng-container
                    *ngIf="(editLoanForm.controls['income_account_number'].dirty || editLoanForm.controls['income_account_number'].touched) && editLoanForm.controls['income_account_number'].errors">
                    <small *ngIf="editLoanForm.controls['income_account_number'].errors['required']"
                      class="text-danger text-xs">Enter account number</small>
                  </ng-container>
                </div>
              </div>
              <div class="col-md-6 mb-3">
                <div class="position-relative pt-1 pb-4 mb-2">
                  <fieldset class="form-control mb-0">
                    <legend>Preferred Bank Name</legend>
                    <select name="preffered_account_bankcode" formControlName="preffered_account_bankcode">
                      <option [value]="null" disabled>Select Bank</option>
                      <option *ngFor="let bank of banks" [value]="bank.code">
                        {{bank.name.toUpperCase()}}</option>
                    </select>
                  </fieldset>
                  <ng-container
                    *ngIf="(editLoanForm.controls['preffered_account_bankcode'].dirty || editLoanForm.controls['preffered_account_bankcode'].touched) && editLoanForm.controls['preffered_account_bankcode'].errors">
                    <small *ngIf="editLoanForm.controls['preffered_account_bankcode'].errors['required']"
                      class="text-danger text-xs">Select bank</small>
                  </ng-container>
                </div>
              </div>
              <div class="col-md-6 mb-3">
                <div class="position-relative pt-1 pb-4 mb-2">
                  <fieldset class="form-control mb-0">
                    <legend>Preferred Account Number</legend>
                    <input type="tel" name="preferred_account_number" formControlName="preferred_account_number">
                  </fieldset>
                  <ng-container
                    *ngIf="(editLoanForm.controls['preferred_account_number'].dirty || editLoanForm.controls['preferred_account_number'].touched) && editLoanForm.controls['preferred_account_number'].errors">
                    <small *ngIf="editLoanForm.controls['preferred_account_number'].errors['required']"
                      class="text-danger text-xs">Enter account number</small>
                  </ng-container>
                </div>
              </div>
            </div>
            <button [disabled]="isLoading" type="button" class="btn btn-purple w-100" (click)="editLoan()">
              <div *ngIf="isLoading" class="spinner-border spinner-border-sm" role="status">
                <span class="visually-hidden">Loading...</span>
              </div>
              <span *ngIf="!isLoading">
                Save Changes
              </span>
            </button>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="exportTransactionsModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content card custom-modal">
      <div class="card-body">
        <i (click)="closeExportTransactionsModal()" role="button" aria-label="Close"
          class="ri-close-line close-modal"></i>
        <h5 class="modal-title text-capitalize">Export Transactions</h5>
        <div class="modal-body">
          <form action="form-group">
            <div class="position-relative pt-1 pb-4 mb-2">
              <fieldset class="form-control mb-0">
                <legend>Document Type</legend>
                <select [formControl]="docTypeControl">
                  <option value="1">Excel</option>
                  <option value="2">PDF</option>
                </select>
              </fieldset>
              <ng-container
                *ngIf="(docTypeControl.dirty || docTypeControl.touched) && docTypeControl.errors">
                <small *ngIf="docTypeControl.errors['required']" class="text-danger text-xs">Select a type</small>
              </ng-container>
            </div>
            <button type="button" [disabled]="isLoading" (click)="exportTransactions()"
              class="btn btn-purple btn-block w-100">
              <div *ngIf="isLoading" class="spinner-border spinner-border-sm" role="status">
                <span class="visually-hidden">Loading...</span>
              </div>
              <span *ngIf="!isLoading">
                Proceed
              </span>
            </button>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="chargeCustomerModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content card custom-modal">
      <div class="card-body">
        <i (click)="closeChargeCustomerModal()" role="button" aria-label="Close" class="ri-close-line close-modal"></i>
        <h5 class="modal-title text-capitalize">Charge Customer</h5>
        <div class="modal-body">
          <form [formGroup]="chargeCustomerForm" action="">
            <div class="position-relative pt-1 pb-4 mb-2">
              <fieldset class="form-control mb-0">
                <legend>Amount</legend>
                <input type="number" name="amount" formControlName="amount">
              </fieldset>
              <ng-container
                *ngIf="(chargeCustomerForm.controls['amount'].dirty || chargeCustomerForm.controls['amount'].touched) && chargeCustomerForm.controls['amount'].errors">
                <small *ngIf="chargeCustomerForm.controls['amount'].errors['required']" class="text-danger text-xs">Enter
                  amount</small>
              </ng-container>
            </div>
            <div class="position-relative pt-1 pb-4 mb-2">
              <fieldset class="form-control mb-0">
                <legend>Last 4 digits of card</legend>
                <input type="text" name="last4" formControlName="last4">
              </fieldset>
              <ng-container
                *ngIf="(chargeCustomerForm.controls['last4'].dirty || chargeCustomerForm.controls['last4'].touched) && chargeCustomerForm.controls['last4'].errors">
                <small *ngIf="chargeCustomerForm.controls['last4'].errors['required']" class="text-danger text-xs">Please
                  fill</small>
              </ng-container>
            </div>
            <button [disabled]="isLoading" type="button" class="btn btn-purple w-100" (click)="chargeCustomer()">
              <div *ngIf="isUploading" class="spinner-border spinner-border-sm" role="status">
                <span class="visually-hidden">Loading...</span>
              </div>
              <span *ngIf="!isUploading">
                Proceed
              </span>
            </button>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="editLoanModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content card custom-modal">
      <div class="card-body">
        <i (click)="closeEditLoanModal()" role="button" aria-label="Close" class="ri-close-line close-modal"></i>
        <h5 class="modal-title text-capitalize">Edit Company</h5>
        <div class="modal-body">
          <form [formGroup]="editLoanForm" action="">
            <div class="row">
              <div class="col-md-6 mb-3">
                <div class="position-relative pt-1 pb-4 mb-2">
                  <fieldset class="form-control mb-0">
                    <legend>Employer Name</legend>
                    <!-- <input type="text" [placeholder]="loadingCompanies? 'Fetching Companies': ''" name="employer_name"
                      formControlName="employer_name" list="companies">
                    <datalist id="companies">
                      <ng-container *ngFor="let item of allCompaniesData">
                        <option #selectItem [value]="item.company_id">{{item.company_name}}</option>
                      </ng-container>
                    </datalist> -->
                    <custom-select [items]="allCompaniesData" formControlName="employer_name"></custom-select>
                  </fieldset>
                  <small *ngIf="loadingCompanies">Fetching Companies.. Please wait</small>
                  <ng-container
                    *ngIf="(editLoanForm.controls['employer_name'].dirty || editLoanForm.controls['employer_name'].touched) && editLoanForm.controls['employer_name'].errors">
                    <small *ngIf="editLoanForm.controls['employer_name'].errors['required']"
                      class="text-danger text-xs">Select employer</small>
                  </ng-container>
                </div>
              </div>
            </div>
            <button [disabled]="isLoading" type="button" class="btn btn-purple w-100" (click)="editLoan()">
              <div *ngIf="isLoading" class="spinner-border spinner-border-sm" role="status">
                <span class="visually-hidden">Loading...</span>
              </div>
              <span *ngIf="!isLoading">
                Save Changes
              </span>
            </button>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="transactionsHistoryModal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content card custom-modal">
      <div class="card-body">
        <i (click)="closeTransactionsModal()" role="button" aria-label="Close" class="ri-close-line close-modal"></i>
        <h5 class="modal-title text-capitalize">Transaction History</h5>
       <div class="modal-body">
        <div class="table-responsive">
          <table class="table">
            <thead class="bg-light text-capitalize">
              <tr>
                <th scope="col">
                  Date
                </th>
                <th scope="col">
                  Loan Id
                </th>
                <th scope="col">
                  Amount
                </th>
                <th scope="col">
                  Type
                </th>
                <th scope="col">
                  Bank Name
                </th>
                <th scope="col">
                  Account Number
                </th>
                <th scope="col">
                  Narration
                </th>
              </tr>
            </thead>
            <tbody>
              <ng-container *ngIf="loanTransactions && loanTransactions.length; else noTableData">
                <tr *ngFor="let item of loanTransactions">
                  <td>
                    {{item?.created_at | date}}
                  </td>
                  <td>
                    {{item?.loan_id}}
                  </td>
                  <td>
                    {{item?.amount}}
                  </td>
                  <td>
                    <span *ngIf="item?.transaction_type == '1'">
                      Debit (Successful)
                    </span>
                    <span *ngIf="item?.transaction_type == '2'">
                      Credit (Successful)
                    </span>
                    <span *ngIf="item?.transaction_type == '3'">
                      Debit (Failed)
                    </span>
                    <span *ngIf="item?.transaction_type == '4'">
                      Credit (Failed)
                    </span>
                  </td>
                  <td>
                    {{item?.bankcode | bankName}}
                  </td>
                  <td>
                    {{item?.accountnumber}}
                  </td>
                  <td>
                    {{item?.narration}}
                  </td>
                </tr>
              </ng-container>
            </tbody>
          </table>
        </div>
       </div>
      </div>
    </div>
  </div>
</div>
